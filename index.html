<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gold Bar Clicker - Ultimate</title>
  <style>
    :root {
      --gold-light: #FFD700;
      --gold-dark: #FFA500;
      --bg-dark: #0d0d0d;
      --text-light: white;
      --stat-bg: #1a1a1a;
    }
    
    body {
      background-color: var(--bg-dark);
      color: var(--text-light);
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 100px;
      margin: 0;
      user-select: none;
      overflow-x: hidden;
    }
    
    /* Gold Rush Progress Header */
    .gold-rush-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 30px;
      background: var(--stat-bg);
      z-index: 100;
      border-bottom: 1px solid var(--gold-light);
    }
    
    .gold-rush-fill {
      height: 100%;
      background: linear-gradient(to right, #4d3319, #FFD700);
      width: 0%;
      transition: width 0.2s ease;
    }
    
    .gold-rush-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      text-shadow: 0 0 3px black;
      width: 100%;
    }
    
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      width: 100%;
      max-width: 1000px;
      margin: auto;
    }
    
    .gold-bar {
      width: 200px;
      height: 120px;
      background: linear-gradient(to top left, var(--gold-light), var(--gold-dark));
      border-radius: 12px;
      box-shadow: 0 0 20px var(--gold-light);
      margin: 20px auto;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
      transition: transform 0.1s ease;
      position: relative;
    }
    
    .gold-bar:active {
      transform: scale(0.95);
    }
    
    .gold-bar.auto-click {
      animation: pulse 0.3s ease;
    }
    
    .gold-bar.golden-click {
      animation: golden-pulse 0.5s ease;
    }
    
    .stat {
      margin: 10px;
      font-size: 1.2em;
    }
    
    .stat-gold {
      background-color: var(--stat-bg);
      color: var(--gold-light);
      padding: 12px 16px;
      border-radius: 10px;
      width: 320px;
      margin: 10px auto;
      border: 1px solid var(--gold-light);
      box-shadow: 0 0 10px #444;
    }
    
    .stat-cps {
      background: white;
      color: black;
      padding: 12px 16px;
      border-radius: 10px;
      width: 320px;
      margin: 10px auto;
      border: 2px solid #e0e0e0;
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
      font-weight: bold;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-cps.hyperdrive {
      animation: hyperdrive 1s linear infinite;
      background-size: 200% 100%;
    }
    
    .upgrade-btn {
      width: 340px;
      height: 100px;
      position: relative;
      text-align: center;
      background: #bdbdbd;
      color: black;
      border: 2px solid var(--gold-light);
      padding: 10px 20px;
      margin: 10px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 8px;
      transition: transform 0.1s ease;
    }
    
    .upgrade-btn:active {
      transform: scale(0.98);
    }
    
    .upgrade-btn img {
  position: absolute;
  top: 8px;
  right: 10px;
  width: 24px;
  filter: brightness(0) invert(0); /* Changed from invert(1) to invert(0) */
}
    
    .upgrade-owned {
      position: absolute;
      top: 8px;
      left: 10px;
      font-size: 0.75em;
      color: var(--gold-light);
    }
    
    .upgrade-title {
      font-size: 1em;
      font-weight: bold;
      margin-top: 25px;
    }
    
    .upgrade-cps {
      position: absolute;
      bottom: 8px;
      left: 10px;
      font-size: 0.75em;
      color: black;
    }
    
    .upgrade-cost {
      position: absolute;
      bottom: 8px;
      right: 10px;
      font-size: 0.75em;
      color: black;
    }
    
    footer {
      margin-top: 40px;
      border-top: 2px solid var(--gold-light);
      padding-top: 20px;
      font-size: 0.9em;
      color: #ccc;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    
    @keyframes golden-pulse {
      0% { transform: scale(1); box-shadow: 0 0 20px var(--gold-light); }
      50% { transform: scale(1.05); box-shadow: 0 0 50px var(--gold-light); }
      100% { transform: scale(1); box-shadow: 0 0 20px var(--gold-light); }
    }
    
    @keyframes wave {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.2); }
    }
    
    @keyframes hyperdrive {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    
    /* Gold Rush Banner */
    .gold-rush-banner {
      position: fixed;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(to right, red, yellow, lime, cyan, blue, magenta, red);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 2em;
      font-weight: bold;
      animation: wave 0.4s ease-in-out infinite;
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    /* Confetti */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: var(--gold-light);
      opacity: 0.8;
      animation: confetti-fall linear forwards;
    }
    
    @keyframes confetti-fall {
      0% { 
        transform: translateY(-100px) rotate(0deg); 
        opacity: 1;
      }
      100% { 
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Click Feedback */
    .click-feedback {
      position: absolute;
      font-size: 1.5em;
      font-weight: bold;
      opacity: 1;
      transition: all 1s ease-out;
      pointer-events: none;
      z-index: 999;
    }
    
    .auto-click-feedback {
      position: fixed;
      font-size: 1.2em;
      font-weight: bold;
      opacity: 1;
      transition: all 1.5s ease-out;
      pointer-events: none;
      z-index: 999;
      color: var(--gold-light);
      text-shadow: 0 0 3px black;
    }
    
    /* Golden Clicks Button */
    .golden-clicks-btn {
      background: linear-gradient(to bottom, var(--gold-light), var(--gold-dark));
      color: black;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 0 10px var(--gold-light);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .golden-clicks-btn:active {
      transform: scale(0.95);
    }
    
    .golden-clicks-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .golden-clicks-cooldown {
      height: 5px;
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }
    
    .golden-clicks-progress {
      height: 100%;
      background: linear-gradient(to right, #FFD700, #FFA500);
      width: 0%;
      transition: width 0.1s linear;
    }
    
    /* Tooltip */
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8em;
      pointer-events: none;
      z-index: 1000;
      transform: translateY(-100%);
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    /* Achievements */
    .achievements-container {
      position: fixed;
      top: 40px;
      right: 20px;
      width: 300px;
      background: rgba(0,0,0,0.7);
      border: 1px solid var(--gold-light);
      border-radius: 10px;
      padding: 10px;
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .achievement {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      padding: 5px;
      background: rgba(255,215,0,0.1);
      border-radius: 5px;
    }
    
    .achievement.unlocked {
      background: rgba(255,215,0,0.3);
    }
    
    .achievement-icon {
      width: 30px;
      height: 30px;
      margin-right: 10px;
      background: var(--gold-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .achievement-info {
      flex: 1;
      text-align: left;
    }
    
    .achievement-name {
      font-weight: bold;
      color: var(--gold-light);
    }
    
    .achievement-desc {
      font-size: 0.8em;
      color: #ccc;
    }
    
    .achievement-progress {
      height: 5px;
      background: rgba(255,255,255,0.2);
      border-radius: 3px;
      margin-top: 3px;
    }
    
    .achievement-progress-fill {
      height: 100%;
      background: var(--gold-light);
      border-radius: 3px;
      width: 0%;
    }
    
    /* Prestige */
    .prestige-btn {
      background: linear-gradient(to bottom, #8A2BE2, #4B0082);
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 20px auto;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 0 15px #8A2BE2;
      display: block;
      transition: transform 0.2s;
    }
    
    .prestige-btn:active {
      transform: scale(0.95);
    }
    
    .prestige-multiplier {
      font-size: 0.9em;
      color: #8A2BE2;
      margin-top: 5px;
    }
    
    #prestige-btn:hover::after {
  content: "Prestige resets your progress but gives permanent 50% bonus to all earnings. Requires 1,000,000 gold.";
  position: absolute;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 10px;
  border-radius: 5px;
  width: 200px;
  left: 50%;
  transform: translateX(-50%);
  bottom: 100%;
  z-index: 100;
}
  </style>
</head>
<body>
  <!-- Gold Rush Progress Header -->
  <div class="gold-rush-header">
    <div class="gold-rush-fill" id="gold-rush-fill"></div>
    <div class="gold-rush-text" id="gold-rush-text">Gold Rush: 0/100</div>
  </div>

  <!-- Achievements Button -->
  <button id="achievements-btn" class="golden-clicks-btn" style="position: fixed; top: 40px; left: 20px;">
    Achievements
  </button>

  <!-- Achievements Panel -->
  <div id="achievements-container" class="achievements-container" style="display: none;">
    <h3 style="color: var(--gold-light); margin-top: 0;">Achievements</h3>
    <div id="achievements-list"></div>
  </div>

  <div class="container">
    <div class="left-panel">
      <h1>Gold Bar Clicker</h1>
      
      <div id="gold-bar" class="gold-bar">Click Me</div>
      
      <div class="stat stat-gold">
        <strong>Gold Bars:</strong> <span id="coin-count">0</span>
      </div>
      <div id="cps-container" class="stat stat-cps">
        <strong>Clicks Per Second:</strong> <span id="cps">0</span>
      </div>
      
      <!-- Golden Clicks Button -->
      <button id="golden-clicks-btn" class="golden-clicks-btn">
        Golden Clicks (10s)
        <div class="golden-clicks-cooldown">
          <div class="golden-clicks-progress" id="golden-clicks-progress"></div>
        </div>
      </button>
      
      <!-- Prestige Button -->
      <button id="prestige-btn" class="prestige-btn">
        Prestige (Get 1,000,000 Gold)
        <div class="prestige-multiplier">Current Multiplier: <span id="prestige-multiplier">1x</span></div>
      </button>
    </div>
    
    <div class="right-panel">
      <button id="buy-auto" class="upgrade-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/104/104739.png" alt="Auto Clicker">
        <div class="upgrade-owned">Owned: <span id="auto-count">0</span></div>
        <div class="upgrade-title">Auto Clicker</div>
        <div class="upgrade-cps">0.1 CPS</div>
        <div class="upgrade-cost">Cost: <span id="auto-cost">10</span></div>
      </button>
      
      <button id="buy-miner" class="upgrade-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/3185/3185927.png" alt="Miner">
        <div class="upgrade-owned">Owned: <span id="miner-count">0</span></div>
        <div class="upgrade-title">Miner</div>
        <div class="upgrade-cps">1 CPS</div>
        <div class="upgrade-cost">Cost: <span id="miner-cost">100</span></div>
      </button>
      
      <button id="buy-machine" class="upgrade-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/2933/2933245.png" alt="Machine">
        <div class="upgrade-owned">Owned: <span id="machine-count">0</span></div>
        <div class="upgrade-title">Machining</div>
        <div class="upgrade-cps">10 CPS</div>
        <div class="upgrade-cost">Cost: <span id="machine-cost">1000</span></div>
      </button>
      
      <button id="buy-drill" class="upgrade-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/2933/2933556.png" alt="Drill">
        <div class="upgrade-owned">Owned: <span id="drill-count">0</span></div>
        <div class="upgrade-title">Drill</div>
        <div class="upgrade-cps">50 CPS</div>
        <div class="upgrade-cost">Cost: <span id="drill-cost">5000</span></div>
      </button>
      
      <button id="buy-lab" class="upgrade-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/3050/3050122.png" alt="Lab">
        <div class="upgrade-owned">Owned: <span id="lab-count">0</span></div>
        <div class="upgrade-title">Gold Lab</div>
        <div class="upgrade-cps">200 CPS</div>
        <div class="upgrade-cost">Cost: <span id="lab-cost">20000</span></div>
      </button>
    </div>
  </div>

  <footer>
    <button id="reset-btn" style="position: fixed; top: 40px; left: 20px; background: #ff4444; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
        Reset Game
      </button>
    <h3 style="color: gold;">How to Play</h3>
    <p>
      Click the gold bar to earn gold bars.<br>
      Purchase upgrades to generate more clicks per second (CPS).<br>
      Gold Rush triggers at increasing intervals (starts at 100 clicks, then 110, etc.)<br>
      Use Golden Clicks for 10 seconds of 2x earnings (5 minute cooldown).<br>
      Prestige at 1,000,000 gold for permanent bonuses.<br>
      Unlock achievements for special rewards!
    </p>
  </footer>

  <script>
    // Game State
    const game = {
      stats: {
        totalClicks: 0,
        manualClicks: 0,
        autoClicks: 0,
        coinCount: 0,
        clicksSinceLastGoldRush: 0,
        goldRushActive: false,
        startTime: performance.now(),
        lastAutoClickTime: 0,
        lastManualClickTime: 0,
        lastClicks: [],
        goldRushThreshold: 100,
        goldenClicksActive: false,
        goldenClicksCooldown: 0,
        lastGoldenClickTime: 0,
        prestigeLevel: 0,
        prestigeMultiplier: 1,
        goldenClickMultiplier: 1
      },
      upgrades: {
        auto: { count: 0, cost: 10, cps: 0.1, costMultiplier: 1.5, name: "Auto Clicker" },
        miner: { count: 0, cost: 100, cps: 1, costMultiplier: 1.6, name: "Miner" },
        machine: { count: 0, cost: 1000, cps: 10, costMultiplier: 1.7, name: "Machining" },
        drill: { count: 0, cost: 5000, cps: 50, costMultiplier: 1.8, name: "Drill" },
        lab: { count: 0, cost: 20000, cps: 200, costMultiplier: 1.9, name: "Gold Lab" }
      },
      achievements: {
        firstClick: { name: "First Click", desc: "Click the gold bar for the first time", unlocked: false, reward: 10 },
        hundredClicks: { name: "100 Clicks", desc: "Reach 100 total clicks", unlocked: false, target: 100, reward: 50 },
        thousandClicks: { name: "1,000 Clicks", desc: "Reach 1,000 total clicks", unlocked: false, target: 1000, reward: 200 },
        firstUpgrade: { name: "First Upgrade", desc: "Purchase your first upgrade", unlocked: false, reward: 100 },
        goldRush: { name: "Gold Rush!", desc: "Trigger your first Gold Rush", unlocked: false, reward: 500 },
        goldenClick: { name: "Golden Touch", desc: "Use Golden Clicks for the first time", unlocked: false, reward: 1000 },
        prestige: { name: "Prestige", desc: "Prestige for the first time", unlocked: false, reward: 5000 }
      },
      elements: {},
      intervals: {},
      goldRushTimeout: null,
      holdClickInterval: null,
      goldenClickInterval: null
    };

    // DOM References
    function cacheElements() {
      game.elements = {
        goldBar: document.getElementById('gold-bar'),
        coinCount: document.getElementById('coin-count'),
        cpsDisplay: document.getElementById('cps'),
        cpsContainer: document.getElementById('cps-container'),
        clickCount: document.getElementById('click-count'),
        goldRushFill: document.getElementById('gold-rush-fill'),
        goldRushText: document.getElementById('gold-rush-text'),
        goldenClicksBtn: document.getElementById('golden-clicks-btn'),
        goldenClicksProgress: document.getElementById('golden-clicks-progress'),
        prestigeBtn: document.getElementById('prestige-btn'),
        prestigeMultiplier: document.getElementById('prestige-multiplier'),
        achievementsBtn: document.getElementById('achievements-btn'),
        achievementsContainer: document.getElementById('achievements-container'),
        achievementsList: document.getElementById('achievements-list'),
        
        // Upgrade buttons
        auto: {
          btn: document.getElementById('buy-auto'),
          count: document.getElementById('auto-count'),
          cost: document.getElementById('auto-cost')
        },
        miner: {
          btn: document.getElementById('buy-miner'),
          count: document.getElementById('miner-count'),
          cost: document.getElementById('miner-cost')
        },
        machine: {
          btn: document.getElementById('buy-machine'),
          count: document.getElementById('machine-count'),
          cost: document.getElementById('machine-cost')
        },
        drill: {
          btn: document.getElementById('buy-drill'),
          count: document.getElementById('drill-count'),
          cost: document.getElementById('drill-cost')
        },
        lab: {
          btn: document.getElementById('buy-lab'),
          count: document.getElementById('lab-count'),
          cost: document.getElementById('lab-cost')
        }
      };
    }

    // Initialize Game
    function initGame() {
      cacheElements();
      setupEventListeners();
      loadGame();
      
      // Main game loop (runs every second for auto-clickers)
      game.intervals.autoClick = setInterval(autoClickLoop, 1000);
      
      // Stats update loop
      game.intervals.statsUpdate = setInterval(updateStats, 250);
      
      // Golden clicks cooldown loop
      game.intervals.goldenClickCooldown = setInterval(updateGoldenClickCooldown, 100);
      
      // Start animation frame loop
      requestAnimationFrame(gameLoop);
      
      // Initialize achievements
      initAchievements();
    }
    document.getElementById('reset-btn').addEventListener('click', () => {
  if (confirm('Are you sure you want to reset ALL progress?')) {
    localStorage.removeItem('goldBarClickerSave');
    location.reload();
  }
});

    // Main game loop
    function gameLoop() {
      updateGoldRushProgress();
      requestAnimationFrame(gameLoop);
    }

    // Event Listeners
    function setupEventListeners() {
      // Gold bar click
      game.elements.goldBar.addEventListener('click', handleClick);
      game.elements.goldBar.addEventListener('mousedown', startHoldClick);
      game.elements.goldBar.addEventListener('mouseup', stopHoldClick);
      game.elements.goldBar.addEventListener('mouseleave', stopHoldClick);
      
      // Upgrade purchases
      game.elements.auto.btn.addEventListener('click', () => buyUpgrade('auto'));
      game.elements.miner.btn.addEventListener('click', () => buyUpgrade('miner'));
      game.elements.machine.btn.addEventListener('click', () => buyUpgrade('machine'));
      game.elements.drill.btn.addEventListener('click', () => buyUpgrade('drill'));
      game.elements.lab.btn.addEventListener('click', () => buyUpgrade('lab'));
      
      // Shift-click for bulk purchases
      game.elements.auto.btn.addEventListener('click', (e) => e.shiftKey && buyMax('auto'));
      game.elements.miner.btn.addEventListener('click', (e) => e.shiftKey && buyMax('miner'));
      game.elements.machine.btn.addEventListener('click', (e) => e.shiftKey && buyMax('machine'));
      game.elements.drill.btn.addEventListener('click', (e) => e.shiftKey && buyMax('drill'));
      game.elements.lab.btn.addEventListener('click', (e) => e.shiftKey && buyMax('lab'));
      
      // Golden clicks
      game.elements.goldenClicksBtn.addEventListener('click', activateGoldenClicks);
      
      // Prestige
      game.elements.prestigeBtn.addEventListener('click', prestige);
      
      // Achievements
      game.elements.achievementsBtn.addEventListener('click', toggleAchievements);
      
      // Tooltips for upgrades
      setupTooltips();
    }

    // Click Handling
    function handleClick(e) {
      const now = Date.now();
      // Prevent multiple clicks from hold-to-click
      if (now - game.stats.lastManualClickTime < 200) return;
      game.stats.lastManualClickTime = now;
      
      const isShift = e.shiftKey;
      const baseClickAmount = isShift ? 10 : 1;
      let multiplier = game.stats.goldRushActive ? 5 : 1;
      multiplier *= game.stats.goldenClicksActive ? game.stats.goldenClickMultiplier : 1;
      multiplier *= game.stats.prestigeMultiplier;
      const clickValue = baseClickAmount * multiplier;
      
      game.stats.totalClicks += baseClickAmount;
      game.stats.manualClicks += baseClickAmount;
      
      // Record click for CPS calculation
      game.stats.lastClicks.push({
        time: now,
        amount: baseClickAmount
      });
      
      if (!game.stats.goldRushActive) {
        game.stats.clicksSinceLastGoldRush += baseClickAmount;
      }
      
      game.stats.coinCount += clickValue;
      
      spawnClickFeedback(clickValue, e.clientX, e.clientY);
      updateStats();
      
      // Check for Gold Rush
      if (game.stats.clicksSinceLastGoldRush >= game.stats.goldRushThreshold && 
          !game.stats.goldRushActive && 
          !game.goldRushTimeout) {
        startGoldRush();
      }
      
      // Check achievements
      checkAchievements();
      
      // Save game state after each click
      saveGame();
    }

    // Hold-to-click functionality
    function startHoldClick(e) {
      if (game.holdClickInterval) clearInterval(game.holdClickInterval);
      handleClick(e); // Initial click
      game.holdClickInterval = setInterval(() => handleClick(e), 300); // Subsequent clicks with delay
    }
    
    function stopHoldClick() {
      if (game.holdClickInterval) {
        clearInterval(game.holdClickInterval);
        game.holdClickInterval = null;
      }
    }

    // Auto-clicker Logic (now runs once per second)
    function autoClickLoop() {
  const now = Date.now();
  let multiplier = game.stats.goldRushActive ? 5 : 1;
  multiplier *= game.stats.goldenClicksActive ? game.stats.goldenClickMultiplier : 1;
  multiplier *= game.stats.prestigeMultiplier;

  // Process each upgrade type separately
  Object.entries(game.upgrades).forEach(([type, upgrade]) => {
    if (upgrade.count > 0) {
      const earned = upgrade.count * upgrade.cps * multiplier;
      
      if (earned > 0) {
        game.stats.coinCount += earned;
        game.stats.autoClicks += upgrade.count * upgrade.cps;
        game.stats.totalClicks += upgrade.count * upgrade.cps;
        
        // Record clicks for CPS calculation
        game.stats.lastClicks.push({
          time: now,
          amount: upgrade.count * upgrade.cps
        });
        
        spawnAutoClickFeedback(earned, type);
      }
    }
  });
  
  // Visual feedback
  game.elements.goldBar.classList.add('auto-click');
  setTimeout(() => game.elements.goldBar.classList.remove('auto-click'), 300);
}

    // Upgrade System
    function buyUpgrade(type) {
      const upgrade = game.upgrades[type];
      
      if (game.stats.coinCount >= upgrade.cost) {
        game.stats.coinCount -= upgrade.cost;
        upgrade.count++;
        upgrade.cost = Math.floor(upgrade.cost * upgrade.costMultiplier);
        
        updateUpgradeDisplay(type);
        updateStats();
        
        // Check for first upgrade achievement
        if (!game.achievements.firstUpgrade.unlocked) {
          unlockAchievement('firstUpgrade');
        }
        
        saveGame();
      }
    }
    
    // Buy as many as possible (shift-click)
    function buyMax(type) {
      const upgrade = game.upgrades[type];
      let affordable = 0;
      let currentCost = upgrade.cost;
      let totalCost = 0;
      
      while (totalCost + currentCost <= game.stats.coinCount) {
        totalCost += currentCost;
        currentCost = Math.floor(currentCost * upgrade.costMultiplier);
        affordable++;
      }
      
      if (affordable > 0) {
        game.stats.coinCount -= totalCost;
        upgrade.count += affordable;
        upgrade.cost = currentCost;
        
        updateUpgradeDisplay(type);
        updateStats();
        
        // Check for first upgrade achievement
        if (!game.achievements.firstUpgrade.unlocked) {
          unlockAchievement('firstUpgrade');
        }
        
        saveGame();
      }
    }

    // Golden Clicks System
    function activateGoldenClicks() {
      if (game.stats.goldenClicksActive || Date.now() - game.stats.lastGoldenClickTime < 300000) return;
      
      game.stats.goldenClicksActive = true;
      game.stats.goldenClickMultiplier = 2;
      game.stats.lastGoldenClickTime = Date.now();
      game.elements.goldenClicksBtn.disabled = true;
      
      // Visual effect
      game.elements.goldBar.classList.add('golden-click');
      
      // Check achievement
      if (!game.achievements.goldenClick.unlocked) {
        unlockAchievement('goldenClick');
      }
      
      // End after 10 seconds
      setTimeout(() => {
        game.stats.goldenClicksActive = false;
        game.elements.goldBar.classList.remove('golden-click');
      }, 10000);
    }
    
    function updateGoldenClickCooldown() {
      const now = Date.now();
      const cooldownRemaining = 300000 - (now - game.stats.lastGoldenClickTime);
      
      if (cooldownRemaining > 0) {
        const percentage = (1 - (cooldownRemaining / 300000)) * 100;
        game.elements.goldenClicksProgress.style.width = `${percentage}%`;
        game.elements.goldenClicksBtn.disabled = true;
      } else {
        game.elements.goldenClicksProgress.style.width = '100%';
        game.elements.goldenClicksBtn.disabled = false;
      }
    }

    // Gold Rush System
    function updateGoldRushProgress() {
      const progress = Math.min(game.stats.clicksSinceLastGoldRush, game.stats.goldRushThreshold);
      const percentage = (progress / game.stats.goldRushThreshold) * 100;
      game.elements.goldRushFill.style.width = `${percentage}%`;
      
      if (game.stats.goldRushActive) {
        // Count down during Gold Rush
        const remaining = game.goldRushTimeout ? 
          Math.ceil((game.goldRushTimeout - Date.now()) / 1000) : 0;
        game.elements.goldRushText.textContent = `GOLD RUSH! ${remaining}s`;
      } else {
        game.elements.goldRushText.textContent = `Gold Rush: ${Math.floor(progress)}/${game.stats.goldRushThreshold}`;
      }
    }
    
    function startGoldRush() {
      game.stats.goldRushActive = true;
      game.goldRushTimeout = Date.now() + 5000; // 5 seconds from now
      
      // Increase threshold for next Gold Rush by 10%
      game.stats.goldRushThreshold = Math.floor(game.stats.goldRushThreshold * 1.1);
      
      createConfetti();
      createGoldRushBanner();
      
      // Check achievement
      if (!game.achievements.goldRush.unlocked) {
        unlockAchievement('goldRush');
      }
      
      // Set timeout to end Gold Rush
      setTimeout(() => {
        game.stats.goldRushActive = false;
        game.stats.clicksSinceLastGoldRush = 0;
        game.goldRushTimeout = null;
        
        // Remove visual effects
        document.querySelectorAll('.confetti-container, .gold-rush-banner').forEach(el => {
          el.style.opacity = '0';
          setTimeout(() => el.remove(), 500);
        });
      }, 5000);
    }

    // Prestige System
    function prestige() {
      if (game.stats.coinCount < 1000000) return;
      
      game.stats.prestigeLevel++;
      game.stats.prestigeMultiplier += 0.5; // Each prestige gives +50% bonus
      
      // Reset game state but keep prestige benefits
      game.stats.coinCount = 0;
      game.stats.totalClicks = 0;
      game.stats.manualClicks = 0;
      game.stats.autoClicks = 0;
      game.stats.clicksSinceLastGoldRush = 0;
      game.stats.goldRushThreshold = 100;
      
      // Reset upgrades
      game.upgrades.auto.count = 0;
      game.upgrades.auto.cost = 10;
      game.upgrades.miner.count = 0;
      game.upgrades.miner.cost = 100;
      game.upgrades.machine.count = 0;
      game.upgrades.machine.cost = 1000;
      game.upgrades.drill.count = 0;
      game.upgrades.drill.cost = 5000;
      game.upgrades.lab.count = 0;
      game.upgrades.lab.cost = 20000;
      
      // Check achievement
      if (!game.achievements.prestige.unlocked) {
        unlockAchievement('prestige');
      }
      
      updateStats();
      Object.keys(game.upgrades).forEach(type => updateUpgradeDisplay(type));
      saveGame();
    }

    // Achievements System
    function initAchievements() {
      game.elements.achievementsList.innerHTML = '';
      
      Object.entries(game.achievements).forEach(([key, achievement]) => {
        const achievementEl = document.createElement('div');
        achievementEl.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
        achievementEl.id = `achievement-${key}`;
        
        achievementEl.innerHTML = `
          <div class="achievement-icon">${achievement.unlocked ? '✓' : '?'}</div>
          <div class="achievement-info">
            <div class="achievement-name">${achievement.name}</div>
            <div class="achievement-desc">${achievement.desc}</div>
            ${achievement.target ? `
              <div class="achievement-progress">
                <div class="achievement-progress-fill" style="width: ${Math.min(100, (game.stats.totalClicks / achievement.target) * 100)}%"></div>
              </div>
            ` : ''}
          </div>
        `;
        
        game.elements.achievementsList.appendChild(achievementEl);
      });
    }
    
    function checkAchievements() {
      // First click
      if (game.stats.totalClicks >= 1 && !game.achievements.firstClick.unlocked) {
        unlockAchievement('firstClick');
      }
      
      // Click milestones
      if (game.stats.totalClicks >= 100 && !game.achievements.hundredClicks.unlocked) {
        unlockAchievement('hundredClicks');
      }
      
      if (game.stats.totalClicks >= 1000 && !game.achievements.thousandClicks.unlocked) {
        unlockAchievement('thousandClicks');
      }
    }
    
    function unlockAchievement(key) {
      const achievement = game.achievements[key];
      if (achievement.unlocked) return;
      
      achievement.unlocked = true;
      game.stats.coinCount += achievement.reward;
      
      // Update achievement display
      const achievementEl = document.getElementById(`achievement-${key}`);
      if (achievementEl) {
        achievementEl.classList.add('unlocked');
        achievementEl.querySelector('.achievement-icon').textContent = '✓';
      }
      
      // Show notification
      spawnClickFeedback(`Achievement: ${achievement.name} +${achievement.reward}`, 
        window.innerWidth / 2, window.innerHeight / 2);
      
      saveGame();
    }
    
    function toggleAchievements() {
      game.elements.achievementsContainer.style.display = 
        game.elements.achievementsContainer.style.display === 'none' ? 'block' : 'none';
    }

    // Visual Effects
    function createConfetti() {
      const container = document.createElement('div');
      container.className = 'confetti-container';
      
      // Create 100 pieces of confetti
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.backgroundColor = `hsl(${Math.random() * 60 + 30}, 100%, 50%)`;
        confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
        confetti.style.animationDelay = `${Math.random() * 0.5}s`;
        container.appendChild(confetti);
      }
      
      document.body.appendChild(container);
      
      // Remove after animation completes
      setTimeout(() => {
        container.style.opacity = '0';
        setTimeout(() => container.remove(), 500);
      }, 5000);
    }
    
    function createGoldRushBanner() {
      const banner = document.createElement('div');
      banner.className = 'gold-rush-banner';
      banner.textContent = 'GOLD RUSH! x5';
      document.body.appendChild(banner);
      
      // Fade in
      setTimeout(() => {
        banner.style.opacity = '1';
      }, 10);
    }
    
    function spawnClickFeedback(amount, x, y) {
      const feedback = document.createElement('div');
      feedback.className = 'click-feedback';
      feedback.textContent = `+${amount}`;
      feedback.style.left = `${x + (Math.random() * 40 - 20)}px`;
      feedback.style.top = `${y + (Math.random() * 40 - 20)}px`;
      feedback.style.color = `hsl(${Math.random() * 60 + 30}, 100%, 50%)`;
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.style.transform = 'translateY(-40px)';
        feedback.style.opacity = '0';
      }, 10);
      
      setTimeout(() => feedback.remove(), 1000);
    }
    
    function spawnAutoClickFeedback(amount, type) {
      const feedback = document.createElement('div');
      feedback.className = 'auto-click-feedback';
      feedback.textContent = `+${amount.toFixed(1)} (${game.upgrades[type].name})`;
      
      // Position near the upgrade button
      const upgradeBtn = game.elements[type].btn;
      const rect = upgradeBtn.getBoundingClientRect();
      
      feedback.style.left = `${rect.left + (Math.random() * 40 - 20)}px`;
      feedback.style.top = `${rect.top + (Math.random() * 40 - 20)}px`;
      
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.style.transform = 'translateY(-40px)';
        feedback.style.opacity = '0';
      }, 10);
      
      setTimeout(() => feedback.remove(), 1500);
    }

    // Stats and Display
    function calculateTotalCPS() {
      return Object.values(game.upgrades).reduce((total, upgrade) => {
        return total + (upgrade.count * upgrade.cps);
      }, 0) * game.stats.prestigeMultiplier;
    }
    
    function calculateActualCPS() {
      const now = Date.now();
      // Remove clicks older than 1 second
      game.stats.lastClicks = game.stats.lastClicks.filter(click => now - click.time < 1000);
      
      // Sum all clicks in the last second
      return game.stats.lastClicks.reduce((total, click) => total + click.amount, 0) * 
             (game.stats.goldenClicksActive ? game.stats.goldenClickMultiplier : 1) *
             game.stats.prestigeMultiplier;
    }
    
    function updateStats() {
      // Calculate actual CPS from recent clicks
      const cps = calculateActualCPS();
      
      // Update displays
      game.elements.clickCount.textContent = game.stats.totalClicks;
      game.elements.coinCount.textContent = game.stats.coinCount.toFixed(1);
      game.elements.cpsDisplay.textContent = cps.toFixed(1);
      game.elements.prestigeMultiplier.textContent = game.stats.prestigeMultiplier.toFixed(1) + 'x';
      
      // Update CPS meter color and style
      updateCPSMeter(cps);
      
      // Update upgrade buttons state
      updateUpgradeButtons();
      
      // Update prestige button
      game.elements.prestigeBtn.disabled = game.stats.coinCount < 1000000;
    }
    
    function updateCPSMeter(cps) {
      const cpsContainer = game.elements.cpsContainer;
      
      // Hyperdrive mode (rainbow) at 150+ CPS
      if (cps >= 150) {
        cpsContainer.classList.add('hyperdrive');
        cpsContainer.style.background = 'linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet, red)';
        cpsContainer.style.backgroundSize = '200% 100%';
        return;
      } else {
        cpsContainer.classList.remove('hyperdrive');
      }
      
      // Smooth color progression from white to rainbow
      let bgColor;
      if (cps >= 125) bgColor = 'linear-gradient(to right, violet, red)';
      else if (cps >= 100) bgColor = 'linear-gradient(to right, indigo, violet)';
      else if (cps >= 75) bgColor = 'linear-gradient(to right, blue, indigo)';
      else if (cps >= 50) bgColor = 'linear-gradient(to right, green, blue)';
      else if (cps >= 25) bgColor = 'linear-gradient(to right, yellow, green)';
      else if (cps >= 10) bgColor = 'linear-gradient(to right, orange, yellow)';
      else if (cps >= 5) bgColor = 'linear-gradient(to right, red, orange)';
      else if (cps >= 1) bgColor = 'linear-gradient(to right, #f0f0f0, red)';
      else bgColor = 'white';
      
      cpsContainer.style.background = bgColor;
    }
    
    function updateUpgradeDisplay(type) {
      const upgrade = game.upgrades[type];
      const element = game.elements[type];
      
      element.count.textContent = upgrade.count;
      element.cost.textContent = upgrade.cost;
    }
    
    function updateUpgradeButtons() {
      Object.keys(game.upgrades).forEach(type => {
        const upgrade = game.upgrades[type];
        const element = game.elements[type];
        
        if (game.stats.coinCount >= upgrade.cost) {
          element.btn.disabled = false;
          element.btn.style.opacity = '1';
        } else {
          element.btn.disabled = true;
          element.btn.style.opacity = '0.7';
        }
      });
    }

    // Tooltips
    function setupTooltips() {
      Object.keys(game.upgrades).forEach(type => {
        const element = game.elements[type];
        const upgrade = game.upgrades[type];
        
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = `Each ${type} produces ${upgrade.cps} clicks per second`;
        element.btn.appendChild(tooltip);
        
        element.btn.addEventListener('mouseenter', () => {
          tooltip.style.opacity = '1';
        });
        
        element.btn.addEventListener('mouseleave', () => {
          tooltip.style.opacity = '0';
        });
      });
    }

    // Save/Load System
    function saveGame() {
      const saveData = {
        stats: {
          totalClicks: game.stats.totalClicks,
          manualClicks: game.stats.manualClicks,
          autoClicks: game.stats.autoClicks,
          coinCount: game.stats.coinCount,
          clicksSinceLastGoldRush: game.stats.clicksSinceLastGoldRush,
          goldRushThreshold: game.stats.goldRushThreshold,
          startTime: game.stats.startTime,
          goldenClicksActive: game.stats.goldenClicksActive,
          lastGoldenClickTime: game.stats.lastGoldenClickTime,
          prestigeLevel: game.stats.prestigeLevel,
          prestigeMultiplier: game.stats.prestigeMultiplier
        },
        upgrades: {
          auto: { count: game.upgrades.auto.count, cost: game.upgrades.auto.cost },
          miner: { count: game.upgrades.miner.count, cost: game.upgrades.miner.cost },
          machine: { count: game.upgrades.machine.count, cost: game.upgrades.machine.cost },
          drill: { count: game.upgrades.drill.count, cost: game.upgrades.drill.cost },
          lab: { count: game.upgrades.lab.count, cost: game.upgrades.lab.cost }
        },
        achievements: game.achievements
      };
      
      localStorage.setItem('goldBarClickerSave', JSON.stringify(saveData));
    }
    
    function loadGame() {
      const saveData = localStorage.getItem('goldBarClickerSave');
      if (!saveData) return;
      
      try {
        const parsed = JSON.parse(saveData);
        
        // Load stats
        game.stats.totalClicks = parsed.stats.totalClicks || 0;
        game.stats.manualClicks = parsed.stats.manualClicks || 0;
        game.stats.autoClicks = parsed.stats.autoClicks || 0;
        game.stats.coinCount = parsed.stats.coinCount || 0;
        game.stats.clicksSinceLastGoldRush = parsed.stats.clicksSinceLastGoldRush || 0;
        game.stats.goldRushThreshold = parsed.stats.goldRushThreshold || 100;
        game.stats.goldenClicksActive = parsed.stats.goldenClicksActive || false;
        game.stats.lastGoldenClickTime = parsed.stats.lastGoldenClickTime || 0;
        game.stats.prestigeLevel = parsed.stats.prestigeLevel || 0;
        game.stats.prestigeMultiplier = parsed.stats.prestigeMultiplier || 1;
        
        // Load upgrades
        game.upgrades.auto.count = parsed.upgrades.auto.count || 0;
        game.upgrades.auto.cost = parsed.upgrades.auto.cost || 10;
        
        game.upgrades.miner.count = parsed.upgrades.miner.count || 0;
        game.upgrades.miner.cost = parsed.upgrades.miner.cost || 100;
        
        game.upgrades.machine.count = parsed.upgrades.machine.count || 0;
        game.upgrades.machine.cost = parsed.upgrades.machine.cost || 1000;
        
        game.upgrades.drill.count = parsed.upgrades.drill.count || 0;
        game.upgrades.drill.cost = parsed.upgrades.drill.cost || 5000;
        
        game.upgrades.lab.count = parsed.upgrades.lab.count || 0;
        game.upgrades.lab.cost = parsed.upgrades.lab.cost || 20000;
        
        // Load achievements
        if (parsed.achievements) {
          Object.keys(parsed.achievements).forEach(key => {
            if (game.achievements[key]) {
              game.achievements[key].unlocked = parsed.achievements[key].unlocked || false;
            }
          });
        }
        
        // Update displays
        updateStats();
        Object.keys(game.upgrades).forEach(type => updateUpgradeDisplay(type));
        initAchievements();
      } catch (e) {
        console.error('Failed to load save:', e);
      }
    }

    // Initialize the game when DOM is loaded
    document.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>